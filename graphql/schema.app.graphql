"""
Suggested GraphQL schema for Amplify AppSync.
Add these types via `amplify update api` -> edit schema, then `amplify push`.
Includes owner-based access and an admin group for read access.
"""

type UserProfile @model @auth(rules: [
  { allow: owner, ownerField: "owner", identityClaim: "cognito:sub" },
  { allow: groups, groups: ["admin"], operations: [read] }
]) {
  id: ID!
  owner: ID!
  email: AWSEmail
  name: String
  birthdate: AWSDate
  city: String
  state: String
  country: String
  pictureKey: String
  createdAt: AWSDateTime
  updatedAt: AWSDateTime
}

type UserActivity @model @auth(rules: [
  { allow: owner, ownerField: "owner", identityClaim: "cognito:sub" },
  { allow: groups, groups: ["admin"], operations: [read] }
]) {
  id: ID!
  owner: ID!
  event: String!
  metadata: AWSJSON
  timestamp: AWSDateTime!
}

"""
Pet type without any public/apiKey access. Owners can manage their own pets; admins can read all.
Add this if you need a secure Pet model.
"""
type Pet @model @auth(rules: [
  { allow: owner, ownerField: "owner", identityClaim: "cognito:sub" },
  { allow: groups, groups: ["admin"], operations: [read] }
]) {
  id: ID!
  owner: ID!
  petType: String
  petName: String
  breed: String
  age: String
  gender: String
  size: String
  color: String
  vaccinated: Boolean
  spayedNeutered: Boolean
  microchipped: Boolean
  description: String
  ownerFirstName: String
  ownerLastName: String
  ownerEmail: AWSEmail
  ownerPhone: String
  address: String
  city: String
  state: String
  zip: String
  specialNeeds: String
  preferences: String
  adoptionFee: String
  availableDate: AWSDate
  photoKeys: [String]
  createdAt: AWSDateTime
  updatedAt: AWSDateTime
}

"""
Discussion types for community forum. Requires `amplify push` after adding.
Images are stored in S3 (public level) using keys in `imageKeys`.
Comments are stored as JSON for simplicity.
"""
type Discussion @model @auth(rules: [
  { allow: public, operations: [read] },
  { allow: owner, ownerField: "owner", identityClaim: "cognito:sub", operations: [create, update, delete, read] },
  { allow: groups, groups: ["admin"], operations: [read, update, delete] }
]) {
  id: ID!
  owner: ID
  author: String
  authorId: ID
  community: String!
  title: String!
  body: String
  imageKeys: [String]
  score: Int
  upvoters: [String]
  downvoters: [String]
  comments: [DiscussionComment] @hasMany(indexName: "byDiscussion", fields: ["id"])
  createdAt: AWSDateTime
  updatedAt: AWSDateTime
  lastActivityAt: AWSDateTime
}

type DiscussionComment @model @auth(rules: [
  { allow: public, operations: [read] },
  { allow: owner, ownerField: "owner", identityClaim: "cognito:sub", operations: [create, update, delete, read] },
  { allow: groups, groups: ["admin"], operations: [read, update, delete] }
]) @index(name: "byDiscussion", fields: ["discussionID", "createdAt"], queryField: "discussionCommentsByDiscussion") {
  id: ID!
  discussionID: ID!
  owner: ID
  author: String
  authorId: ID
  body: String!
  score: Int
  createdAt: AWSDateTime
  updatedAt: AWSDateTime
}
